<html>
<head>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<link href="http://getbootstrap.com/examples/cover/cover.css" rel="stylesheet">
<style>
body {
  background: url(assets/img/bg.jpg) no-repeat center center fixed;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}
select {
  color: #333;
  overflow: scroll;
}
.lead {
  display: inline-block;
  vertical-align: top;
}
.chevrons {
  margin-top: 40px;
}

#status {
  font-size: 14px;
}
</style>
</head>
<body>

<div class="site-wrapper">

  <div class="site-wrapper-inner">

    <div class="cover-container">

      <div class="masthead clearfix">
        <div class="inner">
          <h3 class="masthead-brand">Anam</h3>
        </div>
      </div>

      <div class="inner cover">
        <div class="lead">
        <select multiple id="repoin" class="input-lg">
        <% for repo in repos do %>
          <option><%= repo.name %></option>
        <% end %>
        </select>

        <br>
        <br>
        <button class="btn btn-primary" id="repob">Backup!</button>
        </div>

        <div class="lead chevrons">
        <span class="glyphicon glyphicon-chevron-right"></span>
        <span class="glyphicon glyphicon-chevron-right"></span>
        <span class="glyphicon glyphicon-chevron-right"></span>
        <p id="status">
          Start a backup!
        </p>
        </div>
        <div class="lead">
          <select multiple id="backupin" class="input-lg">
        <% for backup in backups do %>
          <option><%= backup.repo_target.sub login+'/', '' %></option>
        <% end %>
        </select>

        <br>
        <br>
        <button class="btn btn-success" id="repob">Download!</button>
        <button class="btn btn-warning" id="repob">Deactivate!</button>
        <button class="btn btn-danger" id="repob">Delete!</button>

        </div>
        
        
        
        <script type="text/javascript">
        $('#backupin').css('width', $('#repoin').outerWidth())

        // this is a multiple select now, so it needs to loop and call the api multiple times
        $('#repob').click(function(){
          $.ajax({
            url: '/webhooks/new?repo_target='+'<%=login%>'+'/'+$('#repoin').val(),
            type: 'POST'})
          .complete(function(j, status){
              // the webhook has been created
              if(j.status == 201){
                // now let's kick off a backup!
                var backup = j.responseJSON;
                $.ajax({
                  url: '/webhooks/'+backup.external_id,
                  type: 'POST'
                })
                .complete(function(k, status){
                  if(k.status == 201){
                    console.log(k.responseJSON);
                  }
                });
              }
          });
        });
        </script>
        </p>
      </div>

      <div class="mastfoot">
        <div class="inner">
           <p>Built by Andrew Nissen (<a href="http://twitter.com/ambushsabre">@ambushsabre</a>) and Aaron Hammond (<a href="http://twitter.com/kanaborama">@kanaborama</a>). Shoot us an email: <a href="mailto:anamnesis@mit.edu?Subject=You%20rock!" target="_top">anamnesis@mit.edu</a></p>
        </div>
      </div>

    </div>

  </div>

</div>
</body>
</html>
